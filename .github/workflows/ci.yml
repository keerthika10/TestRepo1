
name: CI

on:
  workflow_dispatch:

jobs:
  node.js:
    runs-on: ubuntu-latest
    env:
      REGISTRY: ${REGISTRY:-registry.example.com}
      IMAGE: ${IMAGE:-my-app}
      TAG: ${TAG:-$CI_COMMIT_SHA}

    steps:
      - name: Checkout
        uses: actions/checkout@v4

      
      - name: Setup Node.js
        uses: actions/setup-node@v4
        with:
          node-version: '20'
      

      
      - name: Build (fallback)
        run: |
          npm ci && npm run build
      
      - name: Lint (fallback)
        run: |
          npm run lint
      
      - name: Test (fallback)
        run: |
          npm test --silent
      
      - name: Codescan (fallback)
        run: |
          npm run snyk || echo 'Run your code scanning tool here'
      
      - name: Package (fallback)
        run: |
          docker build -t $REGISTRY/$IMAGE:$TAG .
      
      - name: Publish (fallback)
        run: |
          docker push $REGISTRY/$IMAGE:$TAG
      
      - name: Deploy (fallback)
        run: |
          kubectl apply -f k8s/deployment.yaml --namespace=${NAMESPACE:-default}
      